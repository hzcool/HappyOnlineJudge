(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[29],{4045:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"row justify-center q-mt-lg"},[s("div",{staticClass:"justify-between row",staticStyle:{width:"1600px"}},[s("div",{staticClass:"text-h4 text-black"},[t._v(" "+t._s(t.label)+"  "),s("span",{staticClass:"text-red q-ml-md"},[t._v(" "+t._s(t.title)+" ")])])]),s("div",{staticClass:"justify-between row q-mt-lg",staticStyle:{width:"1600px"}},[s("div",{staticStyle:{width:"1100px"}},[s("GlobalPostCard",{attrs:{post_list:t.discuss_list},on:{getPosts:t.get_discuss,enter:t.enter}})],1),s("div",{staticStyle:{width:"350px"}},[s("q-card",{staticClass:"q-pa-lg",attrs:{flat:""}},[s("Button",{attrs:{type:"primary",size:"large"},on:{click:t.toNewDiscuss}},[t._v("新建提问")]),s("Button",{staticStyle:{"margin-left":"50px"},attrs:{type:"error",size:"large"},on:{click:function(e){return t.$router.push({name:"contest",params:{id:t.contest_id}})}}},[t._v("返回比赛")])],1)],1)])]),s("Modal",{attrs:{width:"1200px",title:"提问",closable:!1,"mask-closable":!1},model:{value:t.newDiscussModal,callback:function(e){t.newDiscussModal=e},expression:"newDiscussModal"}},[s("div",{staticClass:"text-black q-mt-md text-h6"},[s("div",{staticClass:"q-gutter-md row items-start"},[s("div",[t._v("标 题")]),s("q-input",{staticStyle:{width:"500px"},attrs:{dense:"",outlined:"","lazy-rules":"",rules:[function(t){return t&&t.length>0||"请输入标题"},function(t){return t.length<=40||"标题太长"}]},model:{value:t.head,callback:function(e){t.head=e},expression:"head"}})],1),s("div",{staticClass:"q-mt-md"},[s("Tags",{ref:"tags",attrs:{prop_tags:t.prop_tags}})],1),s("q-separator",{staticClass:"q-mt-md"}),s("div",{staticClass:"q-mt-md"},[s("mavon-editor",{ref:"editor",attrs:{defaultOpen:"edit"},on:{imgAdd:t.imgAdd},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1)],1),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"text"},on:{click:function(e){t.newDiscussModal=!1}}},[t._v(" 取消 ")]),s("Button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v(" 提交 ")])],1)])],1)},a=[],n=(s("23bf"),s("06db"),s("7f7f"),s("8a81"),s("1c4c"),s("5df3"),s("cadf"),s("ac6a"),s("3855")),r=s("dc9a");function o(t,e){var s="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!s){if(Array.isArray(t)||(s=l(t))||e&&t&&"number"===typeof t.length){s&&(t=s);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r=!0,o=!1;return{s:function(){s=s.call(t)},n:function(){var t=s.next();return r=t.done,t},e:function(t){o=!0,n=t},f:function(){try{r||null==s.return||s.return()}finally{if(o)throw n}}}}function l(t,e){if(t){if("string"===typeof t)return d(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?d(t,e):void 0}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}var c={name:"problemDiscussion",components:{Tags:n["a"],GlobalPostCard:r["a"]},data:function(){return{label:"",title:"",contest_id:0,index:"",discuss_list:[],newDiscussModal:!1,head:"",prop_tags:[],value:""}},methods:{submit:function(){var t=this;if(this.$store.state.user.is_login)if(this.head=this.head.trim(),""!=this.head)if(""!=this.value.trim()){var e=new FormData;e.set("head",this.head),e.set("kind","puzzle"),e.set("problem",this.index),e.set("content",this.value),e.set("html_content",this.$refs.editor.d_render),e.set("tags",JSON.stringify(this.$refs.tags.get_select_tags())),this.$req.post("newPost",e).then((function(e){void 0==e.errno&&(t.$notify("success","提交成功"),t.value=t.head="",t.newDiscussModal=!1,t.get_discuss(1,10))}))}else this.$notify("error","请输入内容");else this.$notify("error","请输入标题");else this.$notify("error","请先登陆")},toNewDiscuss:function(){this.newDiscussModal=!0},get_discuss:function(t,e){var s=this;this.$req.get("getContestDiscussList",{kind:"puzzle",l:t,r:e,index:this.index,id:this.contest_id}).then((function(t){if(void 0==t.errno){s.discuss_list=t.data;var e,i=o(s.discuss_list);try{for(i.s();!(e=i.n()).done;){var a=e.value;""!=a.tags?a.tags=JSON.parse(a.tags):a.tags=[]}}catch(n){i.e(n)}finally{i.f()}}}))},enter:function(t){this.$router.push({name:"oneContestQuery",params:{puzzle_id:t.post_id,id:this.contest_id}})},imgAdd:function(t,e){var s=this,i=new FormData;i.set("file",e),this.$req.post("addImg",i).then((function(e){s.$refs.editor.$img2Url(t,e.url)}))}},mounted:function(){var t=this;void 0==this.$route.params.id||void 0==this.$route.params.label?this.$router.push({name:"discussions"}):(this.contest_id=this.$route.params.id,this.label=this.$route.params.label,this.$req.get("getCproblemIndexAndTitle",{id:this.contest_id,label:this.label}).then((function(e){void 0==e.errno&&(t.index=e.index,t.title=e.title,t.get_discuss(1,10))})))}},u=c,f=s("4023"),h=s("f09f"),p=s("27f9"),m=s("eb85"),v=s("b2a3"),g=s.n(v),b=Object(f["a"])(u,i,a,!1,null,"4b5b29d3",null);e["default"]=b.exports;g()(b,"components",{QCard:h["a"],QInput:p["a"],QSeparator:m["a"]})}}]);